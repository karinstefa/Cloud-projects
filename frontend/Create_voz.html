<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
    
    
    <!-- Bootstrap Date-Picker Plugin -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css"/>

  
    <title>Hello, world!</title>
  </head>
  <body>
    

    <!-- Optional JavaScript; choose one of the two! -->
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    -->
    <div class="row justify-content-center">
        <div class="col-12">
            <div class="row align-items-center justify-content-center text-center">
                <div class="col-8">
                    <h1>Subir voz al concurso: <label id="NombredelConcurso"></label></h1>
                </div>
                <div class="col-4">
                    <img style="height: 120px;" id="banner"/>
                </div>
            </div>

            <div class="row align-items-center text-center">
                <h4>Va desde el <label id="fecha_inicio"></label> hasta el <label id="fecha_fin"></label></h4>
            </div>

            <div class="row mx-4 mt-2">
                <div class="col-6">
                    <label for="exampleFormControlInput1" class="form-label">Guion o texto que debe expresar la voz</label>
                </div>
                <div class="col-6">
                    <input id="guion" type="text" disabled class="form-control" id="exampleFormControlInput1" placeholder="Escriba el guion">
                </div> 
            </div>
            <div class="row mx-4 mt-2">
                <div class="col-6">
                    <label for="exampleFormControlInput1" class="form-label">Recomendaciones</label>
                </div>
                <div class="col-6">
                    <input id="recomendaciones" disabled type="text" class="form-control" id="exampleFormControlInput1" placeholder="Escriba las recomendaciones que deben ser tenidas en cuenta por los locutores">
                </div>
            </div>
            <div class="row mx-4 mt-2 mb-2 text-center">
                <h3>Ingresa tus datos para participar</h3>
            </div>

            <div class="row mx-4 mt-2">
                <div class="col-4">
                    <label for="nombres">Nombres:</label>
                </div>
                <div class="col-8">
                    <input type="text" class="form-control" id="nombres" placeholder="Nombres..">
                </div>
            </div>

            <div class="row mx-4 mt-2">
                <div class="col-4">
                    <label for="apellidos">Apellidos:</label>
                </div>
                <div class="col-8">
                    <input type="text" class="form-control" id="apellidos" placeholder="Apellidos..">
                </div>
            </div>
            <div class="row mx-4 mt-2">
                <div class="col-4">
                    <label for="correo">Correo</label>
                </div>
                <div class="col-8">
                    <input type="email" class="form-control" id="correo" placeholder="correo@ejemplo.com">
                </div>
            </div>

            <div class="row mx-4 mt-2">
                <div class="col-4">
                    <label for="archivos">Archivo de voz</label>
                </div>
                <div class="col-8">
                    <input class="form-control" type="file" name="file" id="archivos">
                </div>
            </div>

            <div class="row mx-4 mt-2">
                <div class="col-4">
                    <label for="observaciones">Observaciones:</label>
                </div>
                <div class="col-8">
                    <input type="text" class="form-control" id="observaciones" placeholder="Observaciones">
                </div>
            </div>


            <div style="margin-top: 20px;" class="row justify-content-center mx-4">
                <button id="regresar" class="btn btn-primary col-5">Envia tu voz</button>
            </div>
        </div>
    </div>
    
    <script type="text/javascript">
        var id_buscar = "1";
        $(document).ready(async function(){
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            id_buscar = urlParams.get('id')
            let urlBase = 'http://3.84.211.227:8080/'
            let URL = urlBase+'concurso/'+id_buscar
            await fetch(URL)
            .then(response=> {
                if(!response.ok){
                    throw Error(response.statusText);
                }
                return response.json();
            })
            .then(concurso=>{
                document.getElementById('NombredelConcurso').innerHTML = concurso.nombre;
                document.getElementById('banner').src = concurso.path_banner;
                // document.getElementById('valor_premio').value = concurso.valor_premio;
                document.getElementById('guion').value = concurso.guion;
                document.getElementById('fecha_inicio').innerHTML = concurso.fecha_inicio;
                document.getElementById('fecha_fin').innerHTML = concurso.fecha_fin;
                document.getElementById('recomendaciones').value = concurso.recomendaciones;
                // document.getElementById('URL_concurso').value = concurso.url;
            })
            .catch(error => console.log(error) );
        });

        function getBase64(file) {
			return new Promise((resolve, reject) => {
				const reader = new FileReader();
				reader.readAsDataURL(file);
				reader.onload = () => resolve(reader.result);
				reader.onerror = error => reject(error);
                });
			}

        $("#regresar").click(async function(){
            var input = document.querySelector('input[type="file"]').files[0];
            var archivo = '';
            await getBase64(input).then(
                data => {archivo = data;}
            );

            jsondata = {
                id_concurso: id_buscar,
                nombres: document.getElementById('nombres').value,
                apellidos: document.getElementById('apellidos').value,
                correo: document.getElementById('correo').value,
                archivo: archivo,
                observaciones: document.getElementById('observaciones').value
            }
			console.log(jsondata);
            fetch('http://3.84.211.227:8080/voces', {
                method: 'POST',
                headers: {
                "Content-type": "application/json"
                },
                body: JSON.stringify(jsondata)
            })
            .then(response=> response.json())
            .then(dato => {
                console.log(dato);
                alert("Hemos recibido tu voz y la estamos procesando para que sea publicada en la página del concurso y pueda ser posteriormente revisada por nuestro equipo de trabajo. Tan pronto la voz quede publicada en la página del concurso te notificaremos por email");
                history.back();
            })
            .catch(err=>console.error(err));
            /*fetch(URL, {
                method: 'POST',
                headers: {
                    "Content-Type": "application/json",
                    "Access-Control-Request-Headers": "*",
                    "Access-Control-Request-Method": "*"
                },
                body: JSON.stringify(jsondata)
            })
                .then(response => console.log(response))
                .catch(error => console.error(error));
            */
        });
    </script>
</body>
</html>
